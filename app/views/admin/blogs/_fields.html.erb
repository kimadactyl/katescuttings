<%= form_with model: [:admin, @blog], html: { class: @blog.new_record? ? 'admin-form--new' : '' } do |f| %>
  <div class="form-section">
    <%= f.label :title, class: 'form-label' %>
    <%= f.text_field :title, class: 'form__title', autofocus: @blog.new_record? %>
  </div>

  <div class="form-section">
    <%= f.label :body, class: 'form-label' %>
    <%= f.rich_text_area :body %>
  </div>

  <div class="form-section" data-controller="attachments">
    <h3 class="form-section__title">Images</h3>
    <p class="form-section__help">Add images to display in the gallery. Caption appears in the lightbox, alt text is for accessibility.</p>

    <div class="attachment-list" data-attachments-target="list">
      <% @blog.attachments.each do |attachment| %>
        <%= f.fields_for :attachments, attachment do |af| %>
          <%= render 'attachment_fields', f: af, attachment: attachment %>
        <% end %>
      <% end %>
      <% if @blog.new_record? %>
        <%# Start new posts with one empty image slot %>
        <%= f.fields_for :attachments, Attachment.new do |af| %>
          <%= render 'attachment_fields', f: af, attachment: Attachment.new %>
        <% end %>
      <% end %>
    </div>

    <button type="button" class="attachment-add" data-action="click->attachments#add">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <line x1="12" y1="5" x2="12" y2="19"></line>
        <line x1="5" y1="12" x2="19" y2="12"></line>
      </svg>
      Add image
    </button>

    <template data-attachments-target="template">
      <%= f.fields_for :attachments, Attachment.new, child_index: 'NEW_RECORD' do |af| %>
        <%= render 'attachment_fields', f: af, attachment: Attachment.new %>
      <% end %>
    </template>
  </div>

  <div class="form-section">
    <%= f.label :published_at, 'Publication date', class: 'form-label' %>
    <%= f.date_field :published_at, class: 'form-date' %>
  </div>

  <div class="form-section">
    <%= f.submit 'Save post', class: 'form__submit' %>
  </div>
<% end %>
