<% provide :template, 'columns' %>
<% provide :title, @blog.title %>
<% provide :description, truncate(CGI.unescapeHTML(strip_tags(@blog.body.to_s)), length: 150) %>
<% provide :og_type, 'article' %>
<% provide :article_published_time, @blog.published_at.iso8601 %>
<% provide :article_modified_time, @blog.updated_at.iso8601 %>
<% provide :canonical, blog_url(@blog) %>
<% if @blog.attachments.any? %>
  <% variant = @blog.attachments.first.image.variant(resize_to_limit: [1024, 1024])
     provide :image, main_app.url_for(variant.processed) %>
<% end %>

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "<%= j @blog.title %>",
  "datePublished": "<%= @blog.published_at.iso8601 %>",
  "dateModified": "<%= @blog.updated_at.iso8601 %>",
  "author": {
    "@type": "Person",
    "name": "Kate Foale"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Kate's Cuttings",
    "url": "https://katescuttings.net"
  },
  "description": "<%= j truncate(CGI.unescapeHTML(strip_tags(@blog.body.to_s)), length: 300, separator: ' ') %>"<% if @blog.attachments.any? %>,
  "image": "<%= main_app.url_for(@blog.attachments.first.image.variant(resize_to_limit: [1024, 1024]).processed) %>"<% end %>
}
</script>

<article class="blog">
  <h1><%= @blog.title %></h1>
  <div class="date date--large"><span><%= @blog.formatted_date %></span></div>

  <div class="gallery blog__gallery" data-controller="lightbox">
    <%= render partial: 'gallery', locals: { attachments: @blog.attachments } %>
  </div>

  <%= @blog.body %>

  <% if @blog.prev || @blog.next %>
    <div class="blog__links">
      <%= link_to "← Previous article", @blog.prev if @blog.prev %>
      <%= link_to "Next article →", @blog.next if @blog.next %>
    </div>
  <% end %>
</article>

<%= render 'almanac' %>
